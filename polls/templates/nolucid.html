<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GOC Toolkit | Stats Isolation</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        :root {
            --ios-black: #000000;
            --ios-card-bg: rgba(28, 28, 30, 0.9);
            --ios-blue: #0A84FF;
            --ios-green: #30D158;
            --ios-orange: #FF9F0A;
            --ios-teal: #64D2FF;
            --ios-red: #FF453A;
            --ios-gray: #8E8E93;
            --wire-visible: rgba(255, 255, 255, 0.1);
        }

        body {
            background-color: var(--ios-black); color: #FFFFFF;
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", sans-serif;
            min-height: 100vh; display: flex; align-items: center;
            overflow-x: hidden; margin: 0;
        }

        /* Mode Highlights */
        body[class*="-active"] #box-dash, body[class*="-mode"] #box-dash,
        body[class*="-active"] .db-disk, body[class*="-mode"] .db-disk { opacity: 1; }

        body.stats-mode #eaf-node, body.stats-mode #script-node { border-color: var(--ios-blue) !important; box-shadow: 0 0 15px var(--ios-blue); opacity: 1; }
        body.stats-mode #box-dash, body.stats-mode .db-disk { border-color: var(--ios-blue) !important; box-shadow: 0 0 15px var(--ios-blue); color: var(--ios-blue); }

        body.rem-mode #eaf-node, body.rem-mode #script-node, body.rem-mode #server-node { border-color: var(--ios-green) !important; box-shadow: 0 0 15px var(--ios-green); opacity: 1; }
        body.rca-mode #eaf-node, body.rca-mode #script-node, body.rca-mode #server-node { border-color: var(--ios-teal) !important; box-shadow: 0 0 15px var(--ios-teal); opacity: 1; }

        /* Ingestion Highlights */
        body.ai-assistant-active #llm-box, body.ai-assistant-active #snow-box, body.ai-assistant-active #elastic-box, body.ai-assistant-active #kb-box { border-color: var(--ios-teal) !important; box-shadow: 0 0 15px var(--ios-teal); opacity: 1; }
        body.rca-mode #kb-box, body.rca-mode #elastic-box, body.rca-mode #snow-box, body.rca-mode #llm-box { border-color: var(--ios-teal) !important; box-shadow: 0 0 15px var(--ios-teal); opacity: 1; }

        .glass-card {
            background: var(--ios-card-bg); backdrop-filter: blur(30px);
            border: 1px solid rgba(255, 255, 255, 0.12);
            border-radius: 14px; padding: 12px; text-align: center;
            font-size: 0.75rem; font-weight: 500; transition: all 0.4s ease; z-index: 10;
        }

        .exec-flow {
            display: flex; flex-direction: column; align-items: center; gap: 45px;
            width: 100%; max-height: 0; opacity: 0; overflow: visible; transition: all 0.5s ease;
        }
        .exec-flow.visible { max-height: 500px; opacity: 1; margin-top: 45px; }

        /* Production Host Visibility Logic */
        #server-node { display: none; width: 280px; border-color: var(--ios-red); color: var(--ios-red); }
        body.rem-mode #server-node, body.rca-mode #server-node { display: block; }

        .db-disk {
            width: 80px; height: 18px; background: linear-gradient(180deg, #48484A 0%, #1C1C1E 100%);
            border-radius: 50%; border: 1px solid rgba(255,255,255,0.2); margin-bottom: -11px; transition: 0.4s; opacity: 0.4;
        }

        .service-boundary {
            border: 1px solid rgba(255, 255, 255, 0.08); border-radius: 40px; padding: 60px;
            background: radial-gradient(circle at top, rgba(10, 132, 255, 0.04) 0%, transparent 75%); min-width: 650px; position: relative;
        }

        .core-hub { border: 1.5px solid var(--ios-blue); padding: 28px !important; width: 100%; }
        .btn-ios { 
            background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.1); border-radius: 10px;
            padding: 14px 5px; cursor: pointer; transition: 0.2s; font-size: 0.72rem; color: var(--ios-gray);
            height: 100%; display: flex; align-items: center; justify-content: center;
        }
        .btn-ios.active { background: var(--ios-blue) !important; color: #fff !important; box-shadow: 0 0 15px var(--ios-blue); }

        #canvas-svg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; pointer-events: none; }
        .path-line { fill: none; stroke-width: 2.2; stroke-dasharray: 8, 14; animation: dash 25s linear infinite; }
        .path-line.reverse { animation: dash-rev 25s linear infinite; }
        @keyframes dash { from { stroke-dashoffset: 600; } to { stroke-dashoffset: 0; } }
        @keyframes dash-rev { from { stroke-dashoffset: 0; } to { stroke-dashoffset: 600; } }
        .label-apple { font-size: 0.65rem; text-transform: uppercase; letter-spacing: 2px; color: var(--ios-gray); font-weight: 700; margin-bottom: 15px; }
    </style>
</head>
<body id="master-body">
    <svg id="canvas-svg" xmlns="http://www.w3.org/2000/svg"></svg>
    <div class="container-fluid px-5">
        <div class="row align-items-center justify-content-between">
            <div class="col-lg-2">
                <p class="label-apple text-center">Interface</p>
                <div class="glass-card" id="box-dash">GOC Dashboard</div>
            </div>
            <div class="col-lg-6 d-flex flex-column align-items-center">
                <div class="glass-card mb-4" style="border: 2px solid var(--ios-orange); color: #FFF; width: 220px; font-weight: 800;">SSO: AUTHENTICATED</div>
                <div class="service-boundary">
                    <p class="label-apple text-center">Management Layer</p>
                    <div class="glass-card core-hub" id="core-engine">
                        <div style="color:var(--ios-blue); font-weight: 700; font-size: 1.15rem; margin-bottom: 24px;">Django Core Controller</div>
                        <div class="row g-3">
                            <div class="col-4"><div class="btn-ios mode-btn" id="btn-ai">AI Assistant</div></div>
                            <div class="col-4"><div class="btn-ios mode-btn" id="btn-shift" style="color: var(--ios-orange);">Shift Handover</div></div>
                            <div class="col-4"><div class="btn-ios mode-btn" id="btn-rem" style="color: var(--ios-green)">Auto-Remediate</div></div>
                            <div class="col-4"><div class="btn-ios mode-btn" id="btn-rca" style="color: var(--ios-teal)">RCA Analysis</div></div>
                            <div class="col-4"><div class="btn-ios mode-btn" id="btn-gov" style="color: var(--ios-orange);">Governance</div></div>
                            <div class="col-4"><div class="btn-ios mode-btn" id="btn-stats" style="color: var(--ios-blue);">Automation Stats</div></div>
                        </div>
                    </div>
                    <div class="exec-flow" id="exec-flow">
                        <div class="d-flex gap-5">
                            <div class="glass-card" id="eaf-node">EAF Flow (Jenkins)</div>
                            <div class="glass-card" id="script-node">Python Scripts</div>
                        </div>
                        <div class="glass-card" id="server-node">Production Host</div>
                    </div>
                </div>
            </div>
            <div class="col-lg-2">
                <p class="label-apple text-center">Data Ingestion</p>
                <div class="glass-card target-node mb-4" id="elastic-box">Elasticsearch (ESS)</div>
                <div class="glass-card target-node mb-4" id="snow-box">ServiceNow (SNOW)</div>
                <div class="glass-card target-node mb-4" id="kb-box">Knowledge Base</div>
                <p class="label-apple text-center">Intelligence</p>
                <div class="glass-card target-node mb-4" id="llm-box" style="color: var(--ios-teal);">Org LLM Engine</div>
                <p class="label-apple text-center">Persistence</p>
                <div id="db-cluster" class="d-flex flex-column align-items-center">
                    <div class="db-disk"></div><div class="db-disk"></div><div class="db-disk"></div>
                    <span style="font-size: 0.6rem; font-weight: 800; margin-top: 20px; color: var(--ios-gray);">MSSQL CLUSTER</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        const body = document.getElementById('master-body');
        const btns = document.querySelectorAll('.mode-btn');
        const execFlow = document.getElementById('exec-flow');

        function clearModes() {
            body.className = ''; execFlow.classList.remove('visible');
            btns.forEach(b => b.classList.remove('active'));
        }

        const triggerDraw = () => { 
            let count = 0; const interval = setInterval(() => { draw(); if(count++ > 15) clearInterval(interval); }, 40);
        };

        document.getElementById('btn-ai').onclick = function() { clearModes(); body.classList.add('ai-assistant-active'); this.classList.add('active'); triggerDraw(); };
        document.getElementById('btn-shift').onclick = function() { clearModes(); body.classList.add('handover-mode'); this.classList.add('active'); triggerDraw(); };
        document.getElementById('btn-rem').onclick = function() { clearModes(); body.classList.add('rem-mode'); execFlow.classList.add('visible'); this.classList.add('active'); triggerDraw(); };
        document.getElementById('btn-rca').onclick = function() { clearModes(); body.classList.add('rca-mode'); execFlow.classList.add('visible'); this.classList.add('active'); triggerDraw(); };
        document.getElementById('btn-gov').onclick = function() { clearModes(); body.classList.add('gov-mode'); this.classList.add('active'); triggerDraw(); };
        document.getElementById('btn-stats').onclick = function() { clearModes(); body.classList.add('stats-mode'); execFlow.classList.add('visible'); this.classList.add('active'); triggerDraw(); };

        function draw() {
            const svg = document.getElementById('canvas-svg');
            const core = document.getElementById('core-engine').getBoundingClientRect();
            const db = document.getElementById('db-cluster').getBoundingClientRect();
            const dash = document.getElementById('box-dash').getBoundingClientRect();
            svg.innerHTML = '';

            const connect = (x1, y1, x2, y2, color, reverse = false) => {
                const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
                const cp = (x1 + x2) / 2;
                path.setAttribute("d", `M ${x1} ${y1} C ${cp} ${y1}, ${cp} ${y2}, ${x2} ${y2}`);
                path.setAttribute("class", reverse ? "path-line reverse" : "path-line");
                path.style.stroke = color; svg.appendChild(path);
            };

            let activeColor = 'var(--wire-visible)';
            if(body.classList.contains('ai-assistant-active')) activeColor = 'var(--ios-teal)';
            if(body.classList.contains('handover-mode')) activeColor = 'var(--ios-orange)';
            if(body.classList.contains('rca-mode')) activeColor = 'var(--ios-teal)';
            if(body.classList.contains('stats-mode')) activeColor = 'var(--ios-blue)';
            if(body.classList.contains('rem-mode')) activeColor = 'var(--ios-green)';
            if(body.classList.contains('gov-mode')) activeColor = 'var(--ios-orange)';

            connect(dash.right, dash.top + dash.height/2, core.left, core.top + core.height/2, activeColor);
            connect(core.right, core.bottom - 10, db.left, db.top + 10, activeColor);

            ['elastic-box', 'snow-box', 'kb-box', 'llm-box'].forEach(id => {
                const r = document.getElementById(id).getBoundingClientRect();
                let color = 'var(--wire-visible)';
                if(body.classList.contains('ai-assistant-active')) color = 'var(--ios-teal)';
                if(body.classList.contains('gov-mode') && (id==='elastic-box'||id==='snow-box')) color = 'var(--ios-orange)';
                if(body.classList.contains('handover-mode') && id==='snow-box') color = 'var(--ios-orange)';
                if(body.classList.contains('rca-mode')) color = 'var(--ios-teal)';
                connect(r.left, r.top + r.height/2, core.right, core.top + core.height/2, color);
            });

            if(execFlow.classList.contains('visible')) {
                const eaf = document.getElementById('eaf-node').getBoundingClientRect();
                const scr = document.getElementById('script-node').getBoundingClientRect();
                const isStats = body.classList.contains('stats-mode');
                
                // Always connect Core to EAF and Scripts
                connect(core.left + core.width/2, core.bottom, eaf.left + eaf.width/2, eaf.top, activeColor, isStats);
                connect(core.left + core.width/2, core.bottom, scr.left + scr.width/2, scr.top, activeColor, isStats);
                
                // Only connect to Production Host if NOT in Stats mode
                if(!isStats) {
                    const srv = document.getElementById('server-node').getBoundingClientRect();
                    connect(eaf.left + eaf.width/2, eaf.bottom, srv.left + srv.width/2, srv.top, 'var(--ios-red)');
                    connect(scr.left + scr.width/2, scr.bottom, srv.left + srv.width/2, srv.top, 'var(--ios-red)');
                }
            }
        }
        window.onresize = draw; window.onload = draw;
    </script>
</body>
</html>