<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GOC Toolkit | AI Assistant Mode</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        :root {
            --ios-black: #000000;
            --ios-card-bg: rgba(28, 28, 30, 0.9);
            --ios-blue: #0A84FF;
            --ios-green: #30D158;
            --ios-indigo: #5E5CE6;
            --ios-orange: #FF9F0A;
            --ios-teal: #64D2FF;
            --ios-red: #FF453A;
            --ios-cyan: #70D7FF;
            --ios-gray: #8E8E93;
            --wire-visible: rgba(255, 255, 255, 0.2);
        }

        body {
            background-color: var(--ios-black);
            color: #FFFFFF;
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", sans-serif;
            min-height: 100vh;
            display: flex; align-items: center;
            overflow-x: hidden; margin: 0;
        }

        /* Logic to hide the entire left sidebar when AI Assistant is active */
        body.ai-assistant-active .left-sidebar-block {
            display: none !important;
        }

        .glass-card {
            background: var(--ios-card-bg);
            backdrop-filter: blur(30px);
            border: 1px solid rgba(255, 255, 255, 0.12);
            border-radius: 14px;
            padding: 10px;
            text-align: center;
            font-size: 0.72rem;
            font-weight: 500;
            transition: all 0.4s cubic-bezier(0.15, 0, 0.15, 1);
            z-index: 10;
        }

        /* Highlights for requested nodes */
        body.ai-assistant-active #llm-box, 
        body.ai-assistant-active #snow-box, 
        body.ai-assistant-active #kb-box,
        body.ai-assistant-active #elastic-box { 
            border-color: var(--ios-teal); 
            box-shadow: 0 0 18px rgba(100, 210, 255, 0.7); 
            transform: scale(1.05);
            opacity: 1 !important;
            filter: grayscale(0) !important;
        }

        /* Dim others in AI Mode */
        body.ai-assistant-active .target-node:not(#llm-box):not(#snow-box):not(#kb-box):not(#elastic-box) { 
            opacity: 0.15; 
        }

        body.gov-mode .target-node:not(#splunk-box):not(#snow-box) { opacity: 0.15; filter: grayscale(1); }
        body.rca-mode .target-node:not(#llm-box):not(#snow-box):not(#elastic-box):not(#kb-box) { opacity: 0.15; filter: grayscale(1); }

        .service-boundary {
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 40px;
            padding: 50px;
            background: radial-gradient(circle at top, rgba(10, 132, 255, 0.04) 0%, transparent 75%);
            min-width: 600px;
            position: relative;
        }

        .core-hub { border: 1.5px solid var(--ios-blue); padding: 24px !important; }
        
        .btn-ios { 
            background: rgba(255,255,255,0.06); 
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 9px; padding: 10px; cursor: pointer; transition: 0.2s;
            font-size: 0.7rem; color: var(--ios-gray);
        }
        .btn-ios:hover { background: rgba(255,255,255,0.15); color: #fff; }
        .btn-ios.active { background: var(--ios-blue); color: #fff; border-color: #fff; box-shadow: 0 0 20px rgba(10, 132, 255, 0.4); }

        .exec-flow {
            display: flex; flex-direction: column; align-items: center; gap: 40px;
            width: 100%; max-height: 0; opacity: 0; overflow: visible;
            transition: all 0.5s ease;
        }
        .exec-flow.visible { max-height: 400px; opacity: 1; margin-top: 40px; }

        .db-disk {
            width: 85px; height: 18px;
            background: linear-gradient(180deg, #48484A 0%, #1C1C1E 100%);
            border-radius: 50%; border: 1px solid rgba(255,255,255,0.25);
            margin-bottom: -11px;
        }

        #canvas-svg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; pointer-events: none; }
        .path-line { fill: none; stroke-width: 1.8; stroke-dasharray: 6, 12; animation: dash 30s linear infinite; transition: stroke 0.4s, opacity 0.4s; }
        @keyframes dash { from { stroke-dashoffset: 600; } to { stroke-dashoffset: 0; } }
        .label-apple { font-size: 0.6rem; text-transform: uppercase; letter-spacing: 2px; color: var(--ios-gray); font-weight: 700; margin-bottom: 12px; }
    </style>
</head>
<body id="master-body">

    <svg id="canvas-svg" xmlns="http://www.w3.org/2000/svg"></svg>

    <div class="container-fluid px-5">
        <div class="row align-items-center justify-content-between">
            
            <div class="col-lg-2 left-sidebar-block">
                <p class="label-apple text-center">Control Center</p>
                <div class="d-grid gap-4">
                    <div class="glass-card" id="box-dash" style="border-color: var(--ios-blue); color: var(--ios-blue);">GOC Dashboard</div>
                    </div>
            </div>

            <div class="col-lg-6 d-flex flex-column align-items-center">
                <div class="glass-card" id="box-ad" style="border: 1.5px solid var(--ios-orange); color: var(--ios-orange); width: 220px; margin-bottom: 40px;">Active Directory SSO</div>
                
                <div class="service-boundary" id="boundary">
                    <p class="label-apple text-center">Management Layer</p>
                    <div class="glass-card core-hub" id="core-engine">
                        <div style="color:var(--ios-blue); font-weight: 700; font-size: 1.1rem; margin-bottom: 15px;">Django Core Controller</div>
                        <div class="row g-2">
                            <div class="col-6"><div class="btn-ios mode-btn" id="btn-ai-assistant">AI Assistant</div></div>
                            <div class="col-6"><div class="btn-ios mode-btn" id="btn-rem" style="color: var(--ios-green)">Auto-Remediate</div></div>
                            <div class="col-6"><div class="btn-ios mode-btn" id="btn-rca" style="color: var(--ios-teal)">RCA Analysis</div></div>
                            <div class="col-6"><div class="btn-ios mode-btn" id="btn-gov" style="color: var(--ios-orange)">Governance Mode</div></div>
                        </div>
                    </div>

                    <div class="exec-flow" id="exec-flow">
                        <div class="d-flex gap-5">
                            <div class="glass-card" id="eaf-node" style="border-color: var(--ios-green);">EAF Flow</div>
                            <div class="glass-card" id="script-node" style="border-color: var(--ios-green);">Python Automation</div>
                        </div>
                        <div class="glass-card" id="server-node" style="width:280px; border-color: var(--ios-red); color: var(--ios-red);">Production Host</div>
                    </div>
                </div>
            </div>

            <div class="col-lg-2">
                <p class="label-apple text-center">Data Ingestion</p>
                <div class="d-grid gap-2 mb-4">
                    <div class="glass-card target-node" id="elastic-box">Elasticsearch (ESS)</div>
                    <div class="glass-card target-node" id="snow-box">ServiceNow (SNOW)</div>
                    <div class="glass-card target-node" id="splunk-box">Splunk Cloud</div>
                    <div class="glass-card target-node" id="kb-box">Knowledge Base (Confluence)</div>
                </div>
                <p class="label-apple text-center">Intelligence</p>
                <div class="glass-card target-node mb-5" id="llm-box" style="color: var(--ios-teal);">Org LLM Engine</div>
                <p class="label-apple text-center">Persistence</p>
                <div id="db-cluster" class="d-flex flex-column align-items-center">
                    <div class="db-disk"></div><div class="db-disk"></div><div class="db-disk"></div>
                    <span style="font-size: 0.6rem; font-weight: 800; margin-top: 18px; color: var(--ios-gray);">MSSQL CLUSTER</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        const body = document.getElementById('master-body');
        const btns = document.querySelectorAll('.mode-btn');
        const execFlow = document.getElementById('exec-flow');
        let drawInt;

        function resetAll() {
            body.classList.remove('ai-assistant-active', 'gov-mode', 'rca-mode');
            execFlow.classList.remove('visible');
            btns.forEach(b => b.classList.remove('active'));
        }

        function refresh() {
            clearInterval(drawInt);
            drawInt = setInterval(draw, 10);
            setTimeout(() => clearInterval(drawInt), 600);
        }

        document.getElementById('btn-ai-assistant').onclick = function() { 
            resetAll(); 
            body.classList.add('ai-assistant-active'); 
            this.classList.add('active'); 
            refresh(); 
        };

        document.getElementById('btn-rem').onclick = function() { resetAll(); execFlow.classList.add('visible'); this.classList.add('active'); refresh(); };
        document.getElementById('btn-rca').onclick = function() { resetAll(); body.classList.add('rca-mode'); execFlow.classList.add('visible'); this.classList.add('active'); refresh(); };
        document.getElementById('btn-gov').onclick = function() { resetAll(); body.classList.add('gov-mode'); this.classList.add('active'); refresh(); };

        function draw() {
            const svg = document.getElementById('canvas-svg');
            const core = document.getElementById('core-engine').getBoundingClientRect();
            const db = document.getElementById('db-cluster').getBoundingClientRect();
            const ad = document.getElementById('box-ad').getBoundingClientRect();
            const bound = document.getElementById('boundary').getBoundingClientRect();
            svg.innerHTML = '';

            const connect = (x1, y1, x2, y2, color) => {
                const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
                const cp = (x1 + x2) / 2;
                path.setAttribute("d", `M ${x1} ${y1} C ${cp} ${y1}, ${cp} ${y2}, ${x2} ${y2}`);
                path.setAttribute("class", "path-line");
                path.style.stroke = color;
                return path;
            };

            svg.appendChild(connect(ad.left + ad.width/2, ad.bottom, ad.left + ad.width/2, bound.top, 'var(--ios-orange)'));
            svg.appendChild(connect(core.right, core.bottom - 20, db.left, db.top + 10, 'rgba(10, 132, 255, 0.45)'));

            // Only draw control center lines if sidebar is visible
            if (!body.classList.contains('ai-assistant-active')) {
                const dash = document.getElementById('box-dash').getBoundingClientRect();
                svg.appendChild(connect(dash.right, dash.top+dash.height/2, core.left, core.top+core.height/2, 'rgba(10, 132, 255, 0.4)'));
            }

            ['elastic-box', 'snow-box', 'splunk-box', 'kb-box', 'llm-box'].forEach(id => {
                const r = document.getElementById(id).getBoundingClientRect();
                let color = 'var(--wire-visible)';
                
                // Highlight requested nodes in AI Assistant mode
                if(body.classList.contains('ai-assistant-active') && (id==='snow-box'||id==='elastic-box'||id==='llm-box'||id==='kb-box')) color = 'var(--ios-teal)';
                
                if(body.classList.contains('gov-mode') && (id==='splunk-box'||id==='snow-box')) color = 'var(--ios-orange)';
                if(body.classList.contains('rca-mode') && (id==='llm-box'||id==='snow-box'||id==='elastic-box'||id==='kb-box')) color = 'var(--ios-teal)';
                
                svg.appendChild(connect(r.left, r.top+r.height/2, core.right, core.top+core.height/2, color));
            });

            if(execFlow.classList.contains('visible')) {
                const start = document.getElementById('btn-rem').getBoundingClientRect();
                const startRca = document.getElementById('btn-rca').getBoundingClientRect();
                const eaf = document.getElementById('eaf-node').getBoundingClientRect();
                const scr = document.getElementById('script-node').getBoundingClientRect();
                const srv = document.getElementById('server-node').getBoundingClientRect();
                
                let activeBtn = body.classList.contains('rca-mode') ? startRca : start;
                let color = body.classList.contains('rca-mode') ? 'var(--ios-teal)' : 'var(--ios-green)';

                svg.appendChild(connect(activeBtn.left + activeBtn.width/2, activeBtn.bottom, eaf.left + eaf.width/2, eaf.top, color));
                svg.appendChild(connect(activeBtn.left + activeBtn.width/2, activeBtn.bottom, scr.left + scr.width/2, scr.top, color));
                svg.appendChild(connect(eaf.left + eaf.width/2, eaf.bottom, srv.left + srv.width/2, srv.top, 'var(--ios-red)'));
                svg.appendChild(connect(scr.left + scr.width/2, scr.bottom, srv.left + srv.width/2, srv.top, 'var(--ios-red)'));
            }
        }
        window.onresize = draw;
        setTimeout(draw, 100);
    </script>
</body>
</html>